# File: apiserver/schema/services/login.conf (Updated)

_description: """This service provides an administrator management interface to the company's users login information."""
_default {
    internal: false
    allow_roles: ["system", "root", "admin"]
}

supported_modes {
    authorize: null
    "2.9" {
        description: """ Return supported login modes."""
        request {
            type: object
            additionalProperties: false
        }
        response {
            type: object
            properties {
                basic {
                    type: object
                    properties {
                        enabled {
                            description: "Basic authentication (fixed users mode) mode enabled"
                            type: boolean
                        }
                        guest {
                            type: object
                            properties {
                                enabled {
                                    description: "Basic authentication guest mode enabled"
                                    type: boolean
                                }
                                name {
                                    description: "Guest name"
                                    type: string
                                }
                                username {
                                    description: "Guest username"
                                    type: string
                                }
                                password {
                                    description: "Guest password"
                                    type: string
                                }
                            }
                        }
                    }
                }
                sso {
                    description: "SSO authentication providers configuration"
                    type: object
                    additionalProperties {
                        description: "Provider configuration object"
                        type: object
                    }
                }
                sso_providers {
                    description: "The list of SSO authentication providers"
                    type: array
                    items {
                        type: object
                        properties {
                            name {
                                description: "Provider name"
                                type: string
                            }
                            display_name {
                                description: "Provider display name"
                                type: string
                            }
                            login_url {
                                description: "Provider login URL"
                                type: string
                            }
                            enabled {
                                description: "Provider enabled status"
                                type: boolean
                            }
                            icon {
                                description: "Provider icon identifier"
                                type: string
                            }
                            description {
                                description: "Provider description"
                                type: string
                            }
                        }
                        additionalProperties: true
                    }
                }
                server_errors {
                    description: "Server initialization errors"
                    type: object
                    properties {
                        missed_es_upgrade {
                            description: "Indicate that Elasticsearch database was not upgraded from version 5"
                            type: boolean
                        }
                        es_connection_error {
                            description: "Indicate an error communicating to Elasticsearch"
                            type: boolean
                        }
                    }
                }
                authenticated {
                    description: "Is user authenticated"
                    type: boolean
                }
            }
        }
    }
}

logout {
    authorize: null
    allow_roles = [ "*" ]
    "2.13" {
        description: """ Logout (including SSO, if used)) """
        request {
            type: object
            additionalProperties: false
        }
        response {
            type: object
            additionalProperties: false
        }
    }
}

# NEW: Add Casdoor authentication endpoint
casdoor_authenticate {
    authorize: null
    allow_roles: [ "*" ]
    "2.23" {
        description: """ Authenticate user with Casdoor JWT token """
        request {
            type: object
            properties {
                token {
                    description: "Casdoor JWT token for authentication"
                    type: string
                }
            }
            required: ["token"]
            additionalProperties: false
        }
        response {
            type: object
            properties {
                success {
                    description: "Authentication success status"
                    type: boolean
                }
                user {
                    description: "User information if authentication successful"
                    type: object
                    properties {
                        id {
                            description: "User ID"
                            type: string
                        }
                        name {
                            description: "User name"
                            type: string
                        }
                        email {
                            description: "User email address"
                            type: string
                        }
                        company {
                            description: "User company ID"
                            type: string
                        }
                    }
                }
                error {
                    description: "Error message if authentication failed"
                    type: string
                }
            }
            additionalProperties: false
        }
    }
}